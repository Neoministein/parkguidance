<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core" xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui" xmlns:adm="http://github.com/adminfaces"
                template="#{layoutMB.template}">

    <ui:param name="renderBreadCrumb" value="false"/>

    <ui:define name="body">
        <p:panel styleClass="box-primary card">
            <script src="resources/geolocation.js"></script>

            <p:commandButton value="Current Locaion" oncomplete="getLocation();"/>

            <p:remoteCommand name="geoLocationData" process="@this" autoRun="false" actionListener="#{geoLocation.geoLocationListener}"/>

            <p:accordionPanel widgetVar="basic">
                <p:tab title="Address">
                    <p class="p-m-0">
                        <h:form id="input">
                            <p:outputLabel value="Stadt:" for="inputCityName"/>
                            <p:autoComplete id="inputCityName" value="#{geoLocation.model.address.cityName}"
                                            queryDelay="750" completeMethod="#{geoLocation.completeCity}" effect="fade" scrollHeight="250"/>
                            <span class="help-block">
                                <p:message for="inputCityName"/>
                            </span>
                            <p:outputLabel value="Strasse:" for="inputStreet"/>
                            <p:inputText id="inputStreet" value="#{geoLocation.model.address.street}"/>
                            <span class="help-block">
                                <p:message for="inputStreet" />
                            </span>
                            <p:outputLabel value="Hausnummer:" for="inputNumber"/>
                            <p:inputNumber id="inputNumber" value="#{geoLocation.model.address.number}"/>
                            <span class="help-block">
                                <p:message for="inputNumber" />
                            </span>
                            <p:commandButton value="FindByAddress" action="#{geoLocation.findByAddress}"/>
                        </h:form>
                    </p>
                </p:tab>
            </p:accordionPanel>

            <p:separator/>

            <h:form id="form" rendered="#{not geoLocation.model.distanceDataObjects.isEmpty()}">

                <p:repeat value="#{geoLocation.model.distanceDataObjects}" var="distanceObject">
                    <div class="ui-g ui-fluid">
                        <div class="ui-sm-6 ui-g-6 ui-g-nopad">
                            <p:outputLabel value="#{distanceObject.parkingGarage}"/>
                            <br/>
                            <p:outputLabel value="#{distanceObject.parkingGarage.occupied}/#{distanceObject.parkingGarage.spaces}"/>
                        </div>
                        <div class="ui-sm-6 ui-g-3 ui-g-nopad">
                            <p:outputLabel value="#{utils.formatted(distanceObject.parkingGarage.address.toAddressString)}" escape="false"/>
                        </div>
                        <div class="ui-sm-6 ui-g-3 ui-g-nopad">
                            <p:outputLabel value="#{distanceObject.durationString}"/>
                            <br/>
                            <p:outputLabel value="#{distanceObject.distanceString}"/>
                            <br/>
                        </div>
                        <div class="ui-md-offset-6 ui-md-6 ui-sm-offset-0 ui-sm-6">
                            <p:commandButton
                                    value="Directions"
                                    action="#{geoLocation.redirectSearch(distanceObject.parkingGarage)}"
                                    styleClass="btn-block btn-primary"/>
                        </div>
                    </div>
                    <p:separator/>
                </p:repeat>
            </h:form>
        </p:panel>
    </ui:define>
</ui:composition>